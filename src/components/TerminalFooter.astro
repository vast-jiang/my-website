---
// src/components/TerminalFooter.astro
const year = new Date().getFullYear();
---

<footer class="mt-20 border-t border-dos-dim pt-6 pb-10 text-center relative overflow-hidden group">
  
  <!-- ËÉåÊôØÊªöÂä®Ë£ÖÈ•∞ -->
  <div class="absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none select-none flex justify-center items-center overflow-hidden">
    <span class="text-[8rem] md:text-[10rem] font-bold whitespace-nowrap animate-[scan_10s_linear_infinite] group-hover:pause">
      SYSTEM MONITORING ACTIVE
    </span>
  </div>

  <div class="relative z-10 flex flex-col items-center gap-4">
    
    <!-- Âä®ÊÄÅÁ≥ªÁªüÁä∂ÊÄÅÊù° -->
    <div id="sys-bar" class="flex flex-wrap justify-center gap-3 md:gap-6 text-xs font-mono text-dos-dim border border-dos-dim px-4 py-1.5 rounded-full bg-black/80 backdrop-blur shadow-[0_0_10px_rgba(0,143,17,0.2)]">
      
      <!-- 1. ÁΩëÁªúÂª∂Ëøü (ÁúüÂÆû) -->
      <span class="flex items-center gap-1.5 min-w-[80px]">
        <span class="w-2 h-2 rounded-full bg-dos-primary animate-pulse"></span> 
        PING: <span id="ping-val" class="text-dos-primary font-bold">--</span>ms
      </span>

      <!-- 2. CPU Ê†∏ÂøÉÊï∞ (ÁúüÂÆû) -->
      <span class="flex items-center gap-1.5 border-l border-dos-dim/30 pl-3 md:pl-6">
        <span class="w-1.5 h-1.5 bg-dos-dim"></span> 
        CORES: <span id="core-val" class="text-dos-primary">--</span>
      </span>

      <!-- 3. ÁîµÊ±†/ÁîµÊ∫êÁä∂ÊÄÅ (ÁúüÂÆû) -->
      <span class="flex items-center gap-1.5 border-l border-dos-dim/30 pl-3 md:pl-6">
        <span id="bat-icon" class="text-dos-dim">‚ö°</span> 
        PWR: <span id="bat-val" class="text-dos-primary">AC</span>
      </span>

      <!-- 4. Ê®°ÊãüË¥üËΩΩ (ÈöèÊú∫Ê≥¢Âä®) -->
      <span class="flex items-center gap-1.5 border-l border-dos-dim/30 pl-3 md:pl-6">
        LOAD: <span id="load-val" class="text-dos-alert font-bold">0%</span>
      </span>

    </div>

    <p class="text-xs md:text-sm opacity-60 mt-2 font-mono">
      &copy; {year} VAST_JIANG. SYSTEM SECURE. <br class="md:hidden">
      HOSTED ON CLOUDFLARE NETWORK.
    </p>

    <!-- Âº∫Âà∂ÂÖ≥Êú∫ÊåâÈíÆ (ÂΩ©Ëõã) -->
    <button id="shutdown-btn" class="mt-2 text-[10px] border border-dos-alert text-dos-alert px-3 py-1 hover:bg-dos-alert hover:text-black transition uppercase cursor-pointer">
      [ FORCE SHUTDOWN ]
    </button>
  </div>
</footer>

<script>
  // 1. ÂÆö‰πâ‰∏Ä‰∏™ËæÖÂä©ÂáΩÊï∞Ôºå‰∏ìÈó®ÂÆâÂÖ®Âú∞ËÆæÁΩÆÊñáÂ≠óÔºåËß£ÂÜ≥Â§ßÈÉ®ÂàÜ "ÂèØËÉΩ‰∏∫ null" Êä•Èîô
  function setSafeText(id: string, text: string) {
    const el = document.getElementById(id);
    if (el) el.innerText = text;
  }

  // 2. Ëé∑ÂèñÁúüÂÆûÊ†∏ÂøÉÊï∞
  const cores = navigator.hardwareConcurrency || 'N/A';
  // ‰øÆÂ§çÔºö‰ΩøÁî®ËæÖÂä©ÂáΩÊï∞
  setSafeText('core-val', String(cores));

  // 3. Ëé∑ÂèñÁúüÂÆûÁΩëÁªúÂª∂Ëøü (Ping)
  const measurePing = async () => {
    const start = performance.now();
    try {
      await fetch(window.location.href, { method: 'HEAD', cache: 'no-cache' });
      const end = performance.now();
      const ping = Math.round(end - start);
      
      const el = document.getElementById('ping-val');
      if (el) {
        el.innerText = String(ping);
        el.className = ping < 100 ? 'text-dos-primary font-bold' : 'text-dos-alert font-bold';
      }
    } catch (e) {
      // ignore
    }
  };
  measurePing();
  setInterval(measurePing, 3000);

  // 4. Ëé∑ÂèñÁúüÂÆûÁîµÊ±†‰ø°ÊÅØ
  if ('getBattery' in navigator) {
    // @ts-ignore
    navigator.getBattery().then(function(battery) {
      const updateBattery = () => {
        const level = Math.round(battery.level * 100) + '%';
        const charging = battery.charging;
        
        // ‰øÆÂ§çÔºö‰ΩøÁî®ËæÖÂä©ÂáΩÊï∞
        setSafeText('bat-val', level);
        setSafeText('bat-icon', charging ? '‚ö°' : 'üîã');
      };
      updateBattery();
      battery.addEventListener('levelchange', updateBattery);
      battery.addEventListener('chargingchange', updateBattery);
    });
  }

  // 5. Ê®°Êãü CPU Ë¥üËΩΩÊ≥¢Âä®
  let baseLoad = 5;
  document.addEventListener('mousemove', () => { baseLoad = 20; });
  
  setInterval(() => {
    if (baseLoad > 5) baseLoad--;
    const noise = Math.floor(Math.random() * 10);
    const finalLoad = baseLoad + noise;
    
    // ‰øÆÂ§çÔºö‰ΩøÁî®ËæÖÂä©ÂáΩÊï∞
    setSafeText('load-val', finalLoad + '%');
  }, 800);

  // 6. ÂÖ≥Êú∫ÊåâÈíÆÂΩ©Ëõã
  const shutdownBtn = document.getElementById('shutdown-btn');
  // ‰øÆÂ§çÔºöÂÖàÂà§Êñ≠ÊåâÈíÆÊòØÂê¶Â≠òÂú®ÔºåÂÜçÊ∑ªÂä†ÁõëÂê¨‰∫ã‰ª∂
  if (shutdownBtn) {
    shutdownBtn.addEventListener('click', () => {
      // ËøôÈáåÁöÑÊñ≠Ë®Ä (as HTMLElement) ÊòØ‰∏∫‰∫ÜËÆ© TS Áü•ÈÅì body ËÇØÂÆöÊúâ style
      const body = document.body as HTMLElement;
      body.style.filter = 'brightness(0) blur(10px)';
      body.style.transform = 'scale(0.98)';
      body.style.transition = 'all 0.5s';
      setTimeout(() => {
          alert('SYSTEM ERROR: Permission Denied.\n‰Ω†Êó†Ê≥ïÈÄÉÁ¶ªËµõÂçöÁ©∫Èó¥„ÄÇ');
          body.style.filter = '';
          body.style.transform = '';
      }, 1000);
    });
  }
</script>