---
import { FEATURES } from "../../config/site-config";

// 如果开关关闭，直接不渲染
if (!FEATURES.search) return;
---

<div id="search-container" class="relative group w-full">
  <div
    class="absolute -inset-0.5 bg-dos-dim/30 opacity-0 group-hover:opacity-100 transition duration-500 blur-sm"
  >
  </div>
  <div id="search" class="relative font-mono text-sm min-h-[50px]"></div>
</div>

<script is:inline>
  window.addEventListener("load", () => {
    // 检查 DOM 是否存在
    if (!document.getElementById("search")) return;

    const script = document.createElement("script");
    script.src = "/pagefind/pagefind-ui.js";
    script.onload = () => {
      // @ts-ignore
      if (window.PagefindUI) {
        new PagefindUI({
          element: "#search",
          showSubResults: true,
          showImages: false,
          translations: {
            placeholder: "GREP_DATABASE...",
            zero_results: "NO_DATA_FOUND: [SEARCH_TERM]",
          },
        });
      }
    };
    document.head.appendChild(script);
  });
</script>

<style is:global>
  /* Pagefind DOS 风格覆盖 */
  :root {
    --pagefind-ui-scale: 0.8;
    --pagefind-ui-primary: #33ff00;
    --pagefind-ui-text: #33ff00;
    --pagefind-ui-background: #000;
    --pagefind-ui-border: #005f00;
    --pagefind-ui-tag: #005f00;
    --pagefind-ui-font: "VT323", monospace;
  }
  .pagefind-ui__search-input {
    background-color: transparent !important;
    border: 1px solid #005f00 !important;
    color: #33ff00 !important;
    border-radius: 0 !important;
  }
  .pagefind-ui__drawer {
    background-color: #050505 !important;
    border: 1px solid #005f00;
    box-shadow: 0 10px 30px rgba(0, 20, 0, 0.9);
  }
  .pagefind-ui__result {
    border-bottom: 1px dashed #005f00 !important;
  }
  .pagefind-ui__button {
    background: #000 !important;
    color: #33ff00 !important;
    border: 1px solid #33ff00 !important;
  }
</style>
