---

---

<!-- 
  ä¿®å¤é‡ç‚¹ï¼š
  1. ç§»é™¤ mix-blend-screen
  2. å¼ºåˆ¶ min-height
  3. åŠ ä¸€ä¸ªè¾¹æ¡† border ç”¨æ¥è°ƒè¯•åŒºåŸŸèŒƒå›´
-->
<div
  id="hologram-wrapper"
  class="relative w-full overflow-hidden group border border-dos-dim/30 bg-black/40"
  style="height: 350px; min-height: 350px;"
>
  <!-- è£…é¥°æ–‡å­— -->
  <div
    class="absolute top-2 right-2 text-[10px] text-dos-dim font-mono z-10 text-right"
  >
    <div>FOURIER_VISUALIZER</div>
    <div class="flex gap-2 justify-end">
      <span class="text-dos-primary animate-pulse">RENDERING</span>
    </div>
  </div>

  <!-- Canvas å®¹å™¨ -->
  <div id="hologram-container" class="w-full h-full relative z-0"></div>

  <!-- åº•éƒ¨è£…é¥° -->
  <div class="absolute bottom-0 left-0 w-full h-1 bg-dos-primary/20"></div>
</div>

<script>
  import * as THREE from "three";

  function initHologram() {
    console.log("ğŸš€ Hologram: Starting init...");

    const container = document.getElementById("hologram-container");
    if (!container) {
      console.error("âŒ Hologram: Container not found!");
      return;
    }

    // æ¸…ç†æ—§åœºæ™¯
    while (container.firstChild) {
      container.removeChild(container.firstChild);
    }

    // è·å–å°ºå¯¸ï¼Œå¦‚æœä¸º0åˆ™å¼ºåˆ¶ç»™ä¸€ä¸ªå€¼
    let width = container.clientWidth || 300;
    let height = container.clientHeight || 350;
    console.log(`ğŸ“ Hologram Size: ${width}x${height}`);

    // --- 1. åœºæ™¯ ---
    const scene = new THREE.Scene();
    // ç§»é™¤é›¾æ•ˆï¼Œé˜²æ­¢çœ‹ä¸æ¸…
    // scene.fog = new THREE.FogExp2(0x000000, 0.002);

    // --- 2. ç›¸æœº ---
    const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 100);
    camera.position.z = 10; // æ‹‰è¿‘ä¸€ç‚¹ï¼Œç¡®ä¿èƒ½çœ‹åˆ°

    // --- 3. æ¸²æŸ“å™¨ ---
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);

    // --- 4. ç‰©ä½“ï¼šå‚…é‡Œå¶çº½ç»“ ---
    const geometry = new THREE.TorusKnotGeometry(2.5, 0.3, 150, 16, 2, 3);

    // æè´¨ï¼šé«˜äº®çº¿æ¡†ï¼Œä¸é€æ˜
    const material = new THREE.MeshBasicMaterial({
      color: 0x33ff00, // çº¯ DOS ç»¿
      wireframe: true,
      transparent: false, // å…³é—­é€æ˜
      opacity: 1.0, // å®Œå…¨ä¸é€æ˜
    });

    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    // --- 5. ç²’å­ (å¢åŠ è§†è§‰ä½“ç§¯æ„Ÿ) ---
    const pGeo = new THREE.TorusKnotGeometry(2.5, 0.6, 100, 4, 2, 3);
    const pMat = new THREE.PointsMaterial({
      color: 0xffffff,
      size: 0.05,
    });
    const particles = new THREE.Points(pGeo, pMat);
    scene.add(particles);

    // --- 6. åŠ¨ç”» ---
    const animate = () => {
      requestAnimationFrame(animate);

      mesh.rotation.x += 0.005;
      mesh.rotation.y += 0.008;

      particles.rotation.x -= 0.005;
      particles.rotation.y -= 0.008;

      renderer.render(scene, camera);
    };

    animate();
    console.log("âœ¨ Hologram: Animation loop started.");

    // --- Resize ---
    const onResize = () => {
      if (!container) return;
      const w = container.clientWidth;
      const h = container.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    };
    window.addEventListener("resize", onResize);
  }

  // ç«‹å³æ‰§è¡Œ + é¡µé¢åŠ è½½åæ‰§è¡Œ
  initHologram();
  document.addEventListener("astro:page-load", initHologram);
</script>
