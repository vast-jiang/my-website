---
const year = new Date().getFullYear();
---

<footer
  class="mt-20 border-t border-dos-dim pt-6 pb-10 text-center relative overflow-hidden group"
>
  <!-- ËÉåÊôØÊªöÂä®Ë£ÖÈ•∞ -->
  <div
    class="absolute top-0 left-0 w-full h-full opacity-5 pointer-events-none select-none flex justify-center items-center overflow-hidden"
  >
    <span
      class="text-[8rem] md:text-[10rem] font-bold whitespace-nowrap animate-[scan_10s_linear_infinite] group-hover:pause"
    >
      SYSTEM MONITORING ACTIVE
    </span>
  </div>

  <div class="relative z-10 flex flex-col items-center gap-4">
    <!-- Á≥ªÁªüÁä∂ÊÄÅÊù° -->
    <div
      id="sys-bar"
      class="flex flex-wrap justify-center gap-3 md:gap-6 text-xs font-mono text-dos-dim border border-dos-dim px-4 py-1.5 rounded-full bg-black/80 backdrop-blur shadow-[0_0_10px_rgba(0,143,17,0.2)]"
    >
      <span class="flex items-center gap-1.5 min-w-[80px]">
        <span class="w-2 h-2 rounded-full bg-dos-primary animate-pulse"></span>
        PING: <span id="ping-val" class="text-dos-primary font-bold">--</span>ms
      </span>
      <span
        class="flex items-center gap-1.5 border-l border-dos-dim/30 pl-3 md:pl-6"
      >
        <span class="w-1.5 h-1.5 bg-dos-dim"></span>
        CORES: <span id="core-val" class="text-dos-primary">--</span>
      </span>
      <span
        class="flex items-center gap-1.5 border-l border-dos-dim/30 pl-3 md:pl-6"
      >
        <span id="bat-icon" class="text-dos-dim">‚ö°</span>
        PWR: <span id="bat-val" class="text-dos-primary">AC</span>
      </span>
      <span
        class="flex items-center gap-1.5 border-l border-dos-dim/30 pl-3 md:pl-6"
      >
        LOAD: <span id="load-val" class="text-dos-alert font-bold">0%</span>
      </span>
    </div>

    <div class="text-xs md:text-sm opacity-60 mt-2 font-mono space-y-1">
      <p>
        &copy; {year} VAST_JIANG. SYSTEM SECURE.
      </p>
      <p class="flex items-center justify-center gap-2">
        <a
          href="/LICENSE"
          target="_blank"
          class="hover:text-dos-primary transition underline decoration-dashed"
          >[GPL-v3 License]</a
        >
        <span>|</span>
        <span>
          Theme by

          <a
            id="author-credit"
            href="https://github.com/vast-jiang/astro-dos-theme"
            target="_blank"
            class="text-dos-primary font-bold hover:underline hover:shadow-[0_0_10px_#33ff00]"
          >
            VAST_JIANG
          </a>
        </span>
      </p>
    </div>

    <button
      id="shutdown-btn"
      class="mt-2 text-[10px] border border-dos-alert text-dos-alert px-3 py-1 hover:bg-dos-alert hover:text-black transition uppercase cursor-pointer"
    >
      [ FORCE SHUTDOWN ]
    </button>
  </div>
</footer>

<script>
  // ‰ªÖ‰øùÁïôÊó†ÂÆ≥ÁöÑÁ°¨‰ª∂ÁõëÊéßÈÄªËæë
  function setSafeText(id: string, text: string) {
    const el = document.getElementById(id);
    if (el) el.innerText = text;
  }
  const cores = navigator.hardwareConcurrency || "N/A";
  setSafeText("core-val", String(cores));

  const measurePing = async () => {
    const start = performance.now();
    try {
      await fetch(window.location.href, { method: "HEAD", cache: "no-cache" });
      const ping = Math.round(performance.now() - start);
      const el = document.getElementById("ping-val");
      if (el) {
        el.innerText = String(ping);
        el.className =
          ping < 100
            ? "text-dos-primary font-bold"
            : "text-dos-alert font-bold";
      }
    } catch (e) {}
  };
  measurePing();
  setInterval(measurePing, 3000);

  if ("getBattery" in navigator) {
    // @ts-ignore
    navigator.getBattery().then((battery) => {
      const update = () => {
        setSafeText("bat-val", Math.round(battery.level * 100) + "%");
        setSafeText("bat-icon", battery.charging ? "‚ö°" : "üîã");
      };
      update();
      battery.addEventListener("levelchange", update);
      battery.addEventListener("chargingchange", update);
    });
  }
  let baseLoad = 5;
  document.addEventListener("mousemove", () => {
    baseLoad = 20;
  });
  setInterval(() => {
    if (baseLoad > 5) baseLoad--;
    setSafeText("load-val", baseLoad + Math.floor(Math.random() * 10) + "%");
  }, 800);

  document.getElementById("shutdown-btn")?.addEventListener("click", () => {
    const body = document.body as HTMLElement;
    body.style.filter = "brightness(0) blur(10px)";
    body.style.transform = "scale(0.98)";
    body.style.transition = "all 0.5s";
    setTimeout(() => {
      alert("SYSTEM ERROR: Permission Denied.\n‰Ω†Êó†Ê≥ïÈÄÉÁ¶ªËµõÂçöÁ©∫Èó¥„ÄÇ");
      body.style.filter = "";
      body.style.transform = "";
    }, 1000);
  });
</script>
