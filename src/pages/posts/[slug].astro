---
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import TerminalHeader from "../../components/layout/TerminalHeader.astro";
import TerminalFooter from "../../components/layout/TerminalFooter.astro";
import CommentSystem from "../../components/dashboard/CommentSystem.astro";
// üëá ËøôÈáåÁé∞Âú®ËÉΩÊâæÂà∞Êñá‰ª∂‰∫Ü
import TableOfContents from "../../components/blog/TableOfContents.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await render(post); // Ëé∑ÂèñÊ†áÈ¢òÊï∞ÊçÆ
const tags = post.data.tags || [];
---

<BaseLayout title={post.data.title} description={post.data.description}>
  <TerminalHeader />

  <main class="max-w-7xl mx-auto min-h-screen relative px-4">
    <!-- Â§¥ÈÉ®‰ø°ÊÅØ -->
    <div class="mb-8 border-b-2 border-dos-dim pb-4 max-w-4xl">
      <div class="flex justify-between items-start mb-4">
        <div
          class="flex flex-wrap gap-4 text-xs font-mono text-dos-dim uppercase"
        >
          <span>LOG_ID: {post.slug}</span>
          <span>DATE: {post.data.date.toISOString().split("T")[0]}</span>
        </div>
        <div class="flex gap-2">
          {
            tags.map((tag: string) => (
              <a
                href={`/tags/${tag}`}
                class="text-[10px] border border-dos-dim px-1.5 py-0.5 text-dos-dim hover:border-dos-primary hover:text-dos-primary hover:bg-dos-primary/10 transition no-underline"
              >
                #{tag}
              </a>
            ))
          }
        </div>
      </div>
      <h1
        class="text-3xl md:text-5xl font-bold text-dos-primary mb-4 leading-tight"
      >
        {post.data.title}
      </h1>
      <p
        class="text-xl text-dos-dim/80 font-serif italic border-l-4 border-dos-primary pl-4"
      >
        {post.data.description}
      </p>
    </div>

    <!-- Â∑¶Âè≥ÂàÜÊ†èÂ∏ÉÂ±Ä -->
    <div class="flex flex-col xl:flex-row gap-12 items-start">
      <!-- Â∑¶‰æßÊñáÁ´†Ê≠£Êñá -->
      <article
        class="flex-1 min-w-0 prose prose-invert prose-green max-w-none font-mono prose-headings:font-bold prose-headings:text-dos-primary prose-a:text-dos-primary prose-a:no-underline hover:prose-a:underline prose-code:text-dos-alert prose-pre:bg-black prose-pre:border prose-pre:border-dos-dim/50"
      >
        <Content />
      </article>

      <!-- Âè≥‰æßÁõÆÂΩï (‰ªÖÂú®Â§ßÂ±èÊòæÁ§∫) -->
      <aside class="hidden xl:block w-80 flex-shrink-0">
        <TableOfContents headings={headings} />
      </aside>
    </div>

    <!-- Â∫ïÈÉ®ÂäüËÉΩÂå∫ -->
    <div
      class="mt-16 border-t border-dos-dim pt-8 flex justify-between max-w-4xl"
    >
      <a
        href="/"
        class="text-dos-dim hover:text-dos-primary transition no-underline"
      >
        &lt; RETURN_TO_ROOT
      </a>
      <button
        onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
        class="text-dos-dim hover:text-dos-primary transition"
      >
        [ TOP ]
      </button>
    </div>

    <div class="max-w-4xl">
      <CommentSystem />
    </div>
  </main>

  <TerminalFooter />
</BaseLayout>
